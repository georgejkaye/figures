\usepackage{tikz}
\usetikzlibrary{backgrounds}
\usetikzlibrary{arrows}
\usetikzlibrary{shapes,shapes.geometric,shapes.misc,circuits.logic.US}

% this style is applied by default to any tikzpicture included via \tikzfig
\tikzstyle{tikzfig}=[baseline=-0.25em,scale=0.5]

% these are dummy properties used by TikZiT, but ignored by LaTex
\pgfkeys{/tikz/tikzit fill/.initial=0}
\pgfkeys{/tikz/tikzit draw/.initial=0}
\pgfkeys{/tikz/tikzit shape/.initial=0}
\pgfkeys{/tikz/tikzit category/.initial=0}

% standard layers used in .tikz files
\pgfdeclarelayer{edgelayer}
\pgfdeclarelayer{nodelayer}
\pgfsetlayers{background,edgelayer,nodelayer,main}

% style for blank nodes
\tikzstyle{none}=[inner sep=0mm]

% include a .tikz file
\newcommand{\tikzfig}[1]{%
{\tikzstyle{every picture}=[tikzfig]
\IfFileExists{#1.tikz}
  {\input{#1.tikz}}
  {%
    \IfFileExists{./figures/#1.tikz}
      {\input{./figures/#1.tikz}}
      {\tikz[baseline=-0.5em]{\node[draw=red,font=\color{red},fill=red!10!white] {\textit{#1}};}}%
  }}%
}

% the same as \tikzfig, but in a {center} environment
\newcommand{\ctikzfig}[1]{%
\begin{center}\rm
  \tikzfig{graphs/#1}
\end{center}}

% fix strange self-loops, which are PGF/TikZ default
\tikzstyle{every loop}=[]

% inline tikzfig command with optional arguments
\newcommand{\vara}{}
\newcommand{\varb}{}
\newcommand{\varc}{}
\newcommand{\vard}{}
\newcommand{\vare}{}
\newcommand{\varf}{}
\newcommand{\varg}{}
\newcommand{\varh}{}
\NewDocumentCommand\iltikzfig{moooooooo}{%
  \renewcommand{\vara}{\IfValueTF{#2}{#2}{}}%
  \renewcommand{\varb}{\IfValueTF{#3}{#3}{}}%
  \renewcommand{\varc}{\IfValueTF{#4}{#4}{}}%
  \renewcommand{\vard}{\IfValueTF{#5}{#5}{}}%
  \renewcommand{\vare}{\IfValueTF{#6}{#6}{}}%
  \renewcommand{\varf}{\IfValueTF{#7}{#7}{}}%
  \renewcommand{\varg}{\IfValueTF{#8}{#8}{}}%
  \renewcommand{\varh}{\IfValueTF{#9}{#9}{}}%
  \raisebox{0.15em}{\scalebox{0.5}{\tikzfig{#1}}}%
  \IfValueT{#2}{\renewcommand{\vara}{}}%
  \IfValueT{#3}{\renewcommand{\varb}{}}%
  \IfValueT{#4}{\renewcommand{\varc}{}}%
  \IfValueT{#5}{\renewcommand{\vard}{}}%
  \IfValueT{#6}{\renewcommand{\vare}{}}%
  \IfValueT{#7}{\renewcommand{\varf}{}}%
  \IfValueT{#8}{\renewcommand{\varg}{}}%
  \IfValueT{#9}{\renewcommand{\varh}{}}%
}
\NewDocumentCommand\dsptikzfig{moooooooo}{%
  \renewcommand{\vara}{\IfValueTF{#2}{#2}{}}%
  \renewcommand{\varb}{\IfValueTF{#3}{#3}{}}%
  \renewcommand{\varc}{\IfValueTF{#4}{#4}{}}%
  \renewcommand{\vard}{\IfValueTF{#5}{#5}{}}%
  \renewcommand{\vare}{\IfValueTF{#6}{#6}{}}%
  \renewcommand{\varf}{\IfValueTF{#7}{#7}{}}%
  \renewcommand{\varg}{\IfValueTF{#8}{#8}{}}%
  \renewcommand{\varh}{\IfValueTF{#9}{#9}{}}%
  \tikzfig{#1}%
  \IfValueT{#2}{\renewcommand{\vara}{}}%
  \IfValueT{#3}{\renewcommand{\varb}{}}%
  \IfValueT{#4}{\renewcommand{\varc}{}}%
  \IfValueT{#5}{\renewcommand{\vard}{}}%
  \IfValueT{#6}{\renewcommand{\vare}{}}%
  \IfValueT{#7}{\renewcommand{\varf}{}}%
  \IfValueT{#8}{\renewcommand{\varg}{}}%
  \IfValueT{#9}{\renewcommand{\varh}{}}%
}
